<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient-Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admindash.css') }}">
</head>
<body>
    <div class="navbar">
            <div class="icon">
                <img src="{{ url_for('static',filename='icons/home.svg')}}" alt="">
                <a href="/patient_dashboard">Home</a>
            </div>
            <div class="icon">
                <img src="{{ url_for('static',filename='icons/doc.svg')}}" alt="">
                <a href="/doctor_list">Doctors</a>
            </div>
            <div class="icon">
                <img src="{{ url_for('static',filename='icons/app.svg')}}" alt="">
                <a href="/bookappointment">Appointments</a>
            </div>
            <div class="icon">
                <img src="{{ url_for('static',filename='icons/history.svg')}}" alt="">
                <a href="/history">History</a>
            </div>
            <div class="icon">
                <img src="{{ url_for('static',filename='icons/profile.svg')}}" alt="">
                <a href="/updatepatprofile">Profile</a>
            </div>
            <div class="icon">
                <img src="{{ url_for('static',filename='icons/logout.svg')}}" alt="">
                <a href="/">Logout</a>
            </div>
    </div>
    <section class="main">
        <div class="view" style="min-height: 92vh;">
            <div class="welcome">
                <div class="text">
                    <h1>Welcome {{patname}}</h1>
                    <h2>Book, reschedule, or cancel appointments and view your treatment history.<br>Stay informed with easy access to personal medical details and updates.</h2>
                </div>
                <img src="{{ url_for('static',filename='images/docbg.jpg')}}" alt="">
            </div>
            <div class="appointmentss" style="display: flex; justify-content: space-between; background:none;">
                <div class="appointments" style="width: 49.70%; background-color: #101011; margin-top: 0px; margin-bottom: 0px; position: relative;">
                    <h1 style="position: absolute; top: 15px; left: 15px;">Available Department</h1>
                    <table style="width: 95%; height: 75%; margin-top: 40px; margin-left: 30px;">
                        {% for i in depttab %}
                        {% set dept_name = i[0].strip().upper() %}
                        <tr>
                            <td>{{ dept_name }}</td>
                            <td style="display: flex; justify-content: center; align-items: center;">
                                <button popovertarget="popover{{ loop.index }}">View</button>
                                <div id="popover{{ loop.index }}" class="mypopover" popover>
                                    <h3 style="color: black;">{{ dept_name }}</h3>
                                    <h4 style="color: black; padding-top: 30px;">Available Doctors</h4>
                                    {% set doctors = docdict.get(dept_name, []) %}
                                    {% if doctors %}
                                        <ul>
                                            {% for doc in doctors %}
                                                <li style="color: black;">{{ doc }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% else %}
                                        <p style="color: gray;">No doctors available</p>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>
                <div class="appointments" style="width: 49.70%; background-color: #101011; margin-top: 0px; margin-bottom: 0px; position: relative;">
                    <h1 style="position: absolute; top: 15px; left: 15px;">Available Doctors</h1>
                    <table style="width: 95%; margin-top: 40px; margin-left: 50px;">
                        {% for i in doctab %}
                        {% set docname = i[0] %}
                        <tr>
                            <td class="docname">{{ docname }}</td>
                            <td class="viewbut">
                                <button popovertarget="pdoc{{ loop.index }}">View</button>
                                <div id="pdoc{{ loop.index }}" class="mypopover" popover>
                                    <h3 style="color: black;">{{ docname }}</h3>
                                    <h4 style="color: black;">Available Timings</h4>
                                    {% set time = timings.get(docname, []) %}
                                    {% if time %}
                                        <ul>
                                        {% for t in time %}
                                            <li style="color: black;">{{ t }}</li>
                                        {% endfor %}
                                        </ul>
                                    {% else %}
                                        <p style="color: gray;">No timings available</p>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>              
            </div>
            <div class="appointments">
                <h1 id="hmm">Upcoming Appointments</h1>
                <div class="titlee">
                    <div class="app">
                        <h1>Doctor Name</h1>
                    </div>
                    <div class="patient">
                        <h1>Appointment Time</h1>
                    </div>
                    <div class="stat">
                        <h1>Appointment Date</h1>
                    </div>
                    <div class="stat">
                        <h1>Actions</h1>
                    </div>
                </div>
                {% for i in tab%}
                <div class="title">
                    <div class="app">
                        <h1>{{i[1]}}</h1>
                    </div>
                    <div class="patient">
                        <h1>{{i[2]}}</h1>
                    </div>
                    <div class="patient">
                        <h1>{{i[3]}}</h1>
                    </div>
                    <div class="stat" style="display: flex; justify-content: space-evenly; align-items: center; ">
                        <form method="POST" action="{{ url_for('reschedule', app_id=i[0]) }}">
                            <input type="hidden" name="docname" value="{{ i[1] }}">
                            <input type="hidden" name="time" value="{{ i[2] }}">
                            <input type="hidden" name="day" value="{{ i[3] }}">
                            <button type="submit" style="background-color: rgb(0, 255, 55);">
                                Reschedule
                            </button>
                        </form>
                        <form action="{{url_for('cancelapp',app_id=i[0])}}" method="post">
                            <button type="submit" style="background-color: rgb(216, 51, 51);">Cancel</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
</body>
</html>